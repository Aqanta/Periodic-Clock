#include <Arduino.h>
#include <FastLED.h>
#include <Wire.h>
#include <DS3231.h>

#define NUM_LEDS 60
#define DATA_PIN 6
CRGB leds[NUM_LEDS];

DS3231 myRTC;

// Fade parameters
const int fadeDuration = 1000;  // Fade duration in milliseconds (1 second)
const int fps = 60;             // Frames per second
const int frameDelay = 1000 / fps; // Delay between frames in milliseconds
int brightness = 0;  // Initial brightness (0%)

// Fade progression
float fadeIncrement;

void setup() {
    Wire.setSDA(0);
    Wire.setSCL(1);
    Wire.begin();

    FastLED.addLeds<NEOPIXEL, DATA_PIN>(leds, NUM_LEDS);
    fadeIncrement = 128.0 / (fadeDuration / frameDelay); // Calculate brightness increment per frame

    // Initialize Serial communication for logging
    Serial.begin(9600);
}

void printCurrentTime() {
    // Get the current time components
    bool h12;
    bool hPM;
    int hour = myRTC.getHour(h12, hPM); // Get hour (24-hour format)
    int minute = myRTC.getMinute();
    int second = myRTC.getSecond();

    // Print time in HH:MM:SS format
    Serial.print("Current Time: ");
    if (hour < 10) Serial.print("0"); // Add leading zero if necessary
    Serial.print(hour);
    Serial.print(":");
    if (minute < 10) Serial.print("0"); // Add leading zero if necessary
    Serial.print(minute);
    Serial.print(":");
    if (second < 10) Serial.print("0"); // Add leading zero if necessary
    Serial.println(second);
}

void loop() {
    // Fade up from 0 to 128 (0% to 100% brightness)
    while (brightness < 128) {
        fill_solid(leds, NUM_LEDS, CHSV(0, 0, brightness)); // White with variable brightness
        FastLED.show();
        brightness += fadeIncrement;
        if (brightness > 128) brightness = 128; // Cap at 128
        delay(frameDelay);
    }

    delay(500);
    printCurrentTime();

    // Fade down from 128 to 0 (100% to 0% brightness)
    while (brightness > 0) {
        fill_solid(leds, NUM_LEDS, CHSV(0, 0, brightness)); // White with variable brightness
        FastLED.show();
        brightness -= fadeIncrement;
        if (brightness < 0) brightness = 0;
        delay(frameDelay);
    }

    delay(500);
}
